(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0388"],{"4TTZ":function(e,t,r){"use strict";r.r(t);var a=r("14Xm"),n=r.n(a),o=r("sk9p"),s=r.n(o),l=r("oF3Q"),i=r.n(l),u=r("QbLZ"),c=r.n(u),d=r("D3Ub"),f=r.n(d),p=r("LtZ2"),m={components:{},props:{},data:function(){return{IPAndURLRegexp:/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3})$|^((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9]*[A-Za-z0-9]))$/,form:{type:null,key:null,nodes:[],desc:"",enable_websocket:null,hash_on:null},rules:{type:{required:!0}},isEditMode:!1,types:["roundrobin","chash"],defaultHashOnKeys:[{value:"vars",label:"vars"},{value:"header",label:"header"},{value:"cookie",label:"cookie"},{value:"consumer",label:"consumer"}],defaultHashKeys:[{value:"remote_addr",label:"remote_addr"},{value:"host",label:"host"},{value:"uri",label:"uri"},{value:"server_name",label:"server_name"},{value:"server_addr",label:"server_addr"},{value:"request_uri",label:"request_uri"},{value:"query_string",label:"query_string"},{value:"remote_port",label:"remote_port"},{value:"hostname",label:"hostname"},{value:"arg_id",label:"arg_id"}]}},watch:{},computed:{},methods:{onSubmit:function(){var e=this;this.$refs.form.validate(function(){var t=f()(n.a.mark(function t(r){var a,o;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("onSubmit",e.form),a={},e.form.nodes.map(function(e){e.ip&&e.port&&String(e.weights)&&(a[e.ip+":"+e.port]=Number(e.weights||1))}),!r){t.next=21;break}if(o=c()({},e.form,{nodes:a}),e.form.nodes.length){t.next=8;break}return e.$message.error("Please add 1 node at least!"),t.abrupt("return");case 8:if("chash"!==o.type&&delete o.key,i()(o).forEach(function(e){var t=s()(e,2),r=t[0],a=t[1];""!==a&&null!==a||delete o[r]}),!e.isEditMode){t.next=15;break}return t.next=13,Object(p.e)(e.$route.params.id,o);case 13:t.next=17;break;case 15:return t.next=17,Object(p.a)(o);case 17:e.$message.success((e.isEditMode?"Update the":"Create a")+" upstream successfully!"),e.isEditMode||e.$nextTick(function(){e.$router.push({name:"GatewayUpstreamList"})}),t.next=22;break;case 21:return t.abrupt("return",!1);case 22:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())},toPreviousPage:function(){this.$router.go(-1)},typeSelectorChange:function(e){"chash"!==e&&(this.form.key=null)},addNode:function(){this.form.nodes.push({ip:null,port:null,weights:0})},removeNode:function(e){var t=this;this.$confirm("要删除此条节点吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(f()(n.a.mark(function r(){var a;return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:-1!==(a=t.form.nodes.indexOf(e))&&t.form.nodes.splice(a,1);case 2:case"end":return r.stop()}},r,t)}))).catch(function(){})},getData:function(){var e=this;return f()(n.a.mark(function t(){var r,a,o,l,u,c,d,f,m,v,h,b,_,k,y;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$route.params.id,t.next=3,Object(p.c)(r);case 3:a=t.sent,o=a.node.value,l=o.type,u=void 0===l?null:l,c=o.nodes,d=void 0===c?[]:c,f=o.key,m=void 0===f?null:f,v=o.desc,h=void 0===v?"":v,b=o.enable_websocket,_=void 0!==b&&b,k=o.hash_on,y=void 0===k?null:k,d=i()(d).map(function(e){var t=s()(e,2),r=t[0],a=t[1];return{ip:r.split(":")[0],port:r.split(":")[1],weights:a}}),e.form={type:u,key:m,nodes:d,desc:h,enable_websocket:_,hash_on:y};case 19:case"end":return t.stop()}},t,e)}))()}},created:function(){this.isEditMode=-1===this.$route.name.indexOf("GatewayUpstreamCreate"),this.isEditMode&&this.getData()},mounted:function(){}},v=(r("oOB2"),r("KHd+")),h=Object(v.a)(m,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px","show-message":!1}},[r("el-form-item",{attrs:{label:"Desc"}},[r("el-input",{attrs:{placeholder:"Description"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Type",prop:"type"}},[r("el-select",{attrs:{placeholder:"Select a Type"},on:{change:e.typeSelectorChange},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.types,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"Hash On"}},[r("el-select",{attrs:{filterable:"","default-first-option":"","value-key":"form.hash_on",disabled:"chash"!==e.form.type},model:{value:e.form.hash_on,callback:function(t){e.$set(e.form,"hash_on",t)},expression:"form.hash_on"}},e._l(e.defaultHashOnKeys,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),r("p",{staticClass:"tip"},[e._v("选择 chash 参数来源。")])],1),e._v(" "),r("el-form-item",{attrs:{label:"Key"}},[r("el-select",{attrs:{placeholder:"Input a Key","allow-create":"",filterable:"","default-first-option":"","value-key":"form.key",clearable:"",disabled:"chash"!==e.form.type},model:{value:e.form.key,callback:function(t){e.$set(e.form,"key",t)},expression:"form.key"}},e._l(e.defaultHashKeys,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),r("p",{staticClass:"tip"},[e._v("你可以编辑并输入任何值,输入值后回车确认。")])],1),e._v(" "),r("el-form-item",{attrs:{label:"WebSocket"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.form.enable_websocket,callback:function(t){e.$set(e.form,"enable_websocket",t)},expression:"form.enable_websocket"}}),e._v(" "),r("p",{staticClass:"tip"},[e._v(e._s(e.form.enable_websocket?"WebSocket 打开":"WebSocket 关闭"))])],1),e._v(" "),e._l(e.form.nodes,function(t,a){return r("el-form-item",{key:a,staticClass:"node-item",attrs:{label:"Node"+(a+1)}},[r("el-form-item",{attrs:{rules:[{required:!0,type:"string"}],prop:"nodes."+a+".ip"}},[r("el-input",{attrs:{placeholder:"IP/HOST"},model:{value:t.ip,callback:function(r){e.$set(t,"ip",r)},expression:"item.ip"}})],1),e._v(" "),r("el-form-item",{attrs:{rules:[{required:!0}],prop:"nodes."+a+".port"}},[r("el-input",{attrs:{placeholder:"Port",type:"number"},model:{value:t.port,callback:function(r){e.$set(t,"port",r)},expression:"item.port"}})],1),e._v(" "),r("el-form-item",{attrs:{rules:[{required:!0}],prop:"nodes."+a+".weights"}},[r("el-input",{attrs:{placeholder:"Weights",type:"number"},model:{value:t.weights,callback:function(r){e.$set(t,"weights",r)},expression:"item.weights"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"danger"},on:{click:function(r){r.preventDefault(),e.removeNode(t)}}},[e._v("删除")])],1)],1)}),e._v(" "),r("el-form-item",[r("el-button",{on:{click:e.addNode}},[e._v("添加 Node")])],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")]),e._v(" "),r("el-button",{on:{click:e.toPreviousPage}},[e._v("取消")])],1)],2)],1)},[],!1,null,"cbb3e61e",null);h.options.__file="edit.vue";t.default=h.exports},BAfG:function(e,t,r){},E8gZ:function(e,t,r){var a=r("jmDH"),n=r("w6GO"),o=r("NsO/"),s=r("NV0k").f;e.exports=function(e){return function(t){for(var r,l=o(t),i=n(l),u=i.length,c=0,d=[];u>c;)r=i[c++],a&&!s.call(l,r)||d.push(e?[r,l[r]]:l[r]);return d}}},LtZ2:function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"e",function(){return o}),r.d(t,"c",function(){return s}),r.d(t,"a",function(){return l}),r.d(t,"d",function(){return i});var a=r("t3Un");function n(e){return Object(a.a)({url:"/apisix/admin/upstreams",method:"GET",params:e})}var o=function(e,t){return Object(a.a)({url:"/apisix/admin/upstreams/"+e,method:"PUT",data:t})},s=function(e){return Object(a.a)({url:"/apisix/admin/upstreams/"+e,method:"GET"})},l=function(e){return Object(a.a)({url:"/apisix/admin/upstreams",method:"post",data:e})},i=function(e){return Object(a.a)({url:"/apisix/admin/upstreams/"+e,method:"DELETE"})}},nGDx:function(e,t,r){var a=r("Y7ZC"),n=r("E8gZ")(!0);a(a.S,"Object",{entries:function(e){return n(e)}})},oF3Q:function(e,t,r){e.exports={default:r("tgZa"),__esModule:!0}},oOB2:function(e,t,r){"use strict";var a=r("BAfG");r.n(a).a},tgZa:function(e,t,r){r("nGDx"),e.exports=r("WEpk").Object.entries}}]);
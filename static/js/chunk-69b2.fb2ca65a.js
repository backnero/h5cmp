(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-69b2"],{"+Xbv":function(t,e,n){"use strict";var r=n("VbZm");n.n(r).a},"4fRq":function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},"8gsd":function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"e",function(){return a}),n.d(e,"c",function(){return u}),n.d(e,"d",function(){return s}),n.d(e,"a",function(){return o});var r=n("t3Un");function i(t){return Object(r.a)({url:"/apisix/admin/services",method:"GET",params:t})}var a=function(t,e){return Object(r.a)({url:"/apisix/admin/services/"+t,method:"PUT",data:e})},u=function(t){return Object(r.a)({url:"/apisix/admin/services/"+t,method:"GET"})},s=function(t){return Object(r.a)({url:"/apisix/admin/services/"+t,method:"DELETE"})},o=function(t){return Object(r.a)({url:"/apisix/admin/services",method:"POST",data:t})}},E8gZ:function(t,e,n){var r=n("jmDH"),i=n("w6GO"),a=n("NsO/"),u=n("NV0k").f;t.exports=function(t){return function(e){for(var n,s=a(e),o=i(s),c=o.length,l=0,f=[];c>l;)n=o[l++],r&&!u.call(s,n)||f.push(t?[n,s[n]]:s[n]);return f}}},I2ZF:function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,i=n;return[i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]]].join("")}},LtZ2:function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"e",function(){return a}),n.d(e,"c",function(){return u}),n.d(e,"a",function(){return s}),n.d(e,"d",function(){return o});var r=n("t3Un");function i(t){return Object(r.a)({url:"/apisix/admin/upstreams",method:"GET",params:t})}var a=function(t,e){return Object(r.a)({url:"/apisix/admin/upstreams/"+t,method:"PUT",data:e})},u=function(t){return Object(r.a)({url:"/apisix/admin/upstreams/"+t,method:"GET"})},s=function(t){return Object(r.a)({url:"/apisix/admin/upstreams",method:"post",data:t})},o=function(t){return Object(r.a)({url:"/apisix/admin/upstreams/"+t,method:"DELETE"})}},RovF:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("t3Un"),i=function(){return Object(r.a)({url:"/apisix/admin/plugins/list",method:"get"})}},SIrY:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("t3Un"),i=function(t){return Object(r.a)({url:"/apisix/admin/schema/plugins/"+t,method:"get"})}},VbZm:function(t,e,n){},cK55:function(t,e,n){"use strict";n.r(e);var r=n("GQeE"),i=n.n(r),a=n("EJiy"),u=n.n(a),s=n("sk9p"),o=n.n(s),c=n("oF3Q"),l=n.n(c),f=n("P2sY"),p=n.n(f),d=n("QbLZ"),m=n.n(d),v=n("14Xm"),g=n.n(v),h=n("D3Ub"),b=n.n(h),w=n("LtZ2"),x=n("8gsd"),P=n("RovF"),k={name:"RouterEdit",components:{PluginDialog:n("yPmT").a},props:{},data:function(){return{form:{plugins:{},upstream_id:"",desc:""},rules:{},isEditMode:!1,pluginList:[],pluginName:"",showPluginDialog:!1,upstreamList:[]}},watch:{},computed:{filteredPluginList:function(){var t=this;return this.pluginList.filter(function(e){return!t.form.plugins.hasOwnProperty(e)})}},methods:{toPreviousPage:function(){this.$router.go(-1)},getData:function(){var t=this;return b()(g.a.mark(function e(){var n,r,i,a,u,s,o,c,l;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$route.params.id,e.next=3,Object(x.c)(n);case 3:r=e.sent,i=r.node.value,a=i.plugins,u=void 0===a?{}:a,s=i.upstream_id,o=void 0===s?"":s,c=i.desc,l=void 0===c?"":c,t.form={plugins:u,upstream_id:o,desc:l};case 12:case"end":return e.stop()}},e,t)}))()},getUpstreamList:function(){var t=this;return b()(g.a.mark(function e(){var n,r,i;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.b)();case 2:n=e.sent,r=n.node.nodes,i=void 0===r?[]:r,t.upstreamList=i.map(function(t){var e=t.key.match(/\/([0-9]+)/)[1];return m()({},t.value,{id:e})});case 6:case"end":return e.stop()}},e,t)}))()},getPluginList:function(){var t=this;return b()(g.a.mark(function e(){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(P.a)();case 2:n=e.sent,t.pluginList=n;case 4:case"end":return e.stop()}},e,t)}))()},showPlugin:function(t){var e=this;return b()(g.a.mark(function n(){return g.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e.pluginName=t,e.showPluginDialog=!0;case 2:case"end":return n.stop()}},n,e)}))()},onPluginSave:function(t,e){delete this.form.plugins.tempPlugin,this.showPluginDialog=!1,this.form.plugins[t]=e},addPlugin:function(){var t=this;return b()(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.form.plugins.hasOwnProperty("tempPlugin")){e.next=2;break}return e.abrupt("return");case 2:t.form.plugins=m()({},t.form.plugins,{tempPlugin:null});case 3:case"end":return e.stop()}},e,t)}))()},onSubmit:function(){var t=this;return b()(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.$refs.form.validate(function(){var e=b()(g.a.mark(function e(n){var r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onSubmit",t.form),!n){e.next=16;break}if(delete t.form.plugins.tempPlugin,r=p()({},t.form),l()(r).forEach(function(t){var e=o()(t,2),n=e[0],a=e[1];"object"===u()(r[n])?"plugins"!==n&&0===i()(a).length&&delete r[n]:""===a&&delete r[n]}),!t.isEditMode){e.next=10;break}return e.next=8,Object(x.e)(t.$route.params.id,r);case 8:e.next=12;break;case 10:return e.next=12,Object(x.a)(r);case 12:t.$message.success((t.isEditMode?"Update the":"Create a")+" service successfully!"),t.isEditMode||t.$nextTick(function(){t.$router.push({name:"GatewayServicesList"})}),e.next=17;break;case 16:return e.abrupt("return",!1);case 17:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,t)}))()},removePlugin:function(t){var e=this;this.$confirm("Do you want to remove "+t+" plugin?","Warning",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(b()(g.a.mark(function n(){return g.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e.$delete(e.form.plugins,t);case 1:case"end":return n.stop()}},n,e)}))).catch(function(){})}},created:function(){this.isEditMode=-1===this.$route.name.indexOf("GatewayServicesCreate"),this.getUpstreamList(),this.getPluginList(),this.isEditMode&&this.getData()}},_=(n("+Xbv"),n("KHd+")),y=Object(_.a)(k,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px","show-message":!1}},[n("el-form-item",{attrs:{label:"Desc"}},[n("el-input",{attrs:{placeholder:"Description"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"Upstream"}},[n("el-select",{attrs:{placeholder:"Upstream"},model:{value:t.form.upstream_id,callback:function(e){t.$set(t.form,"upstream_id",e)},expression:"form.upstream_id"}},t._l(t.upstreamList,function(t){return n("el-option",{key:t.id,attrs:{label:t.desc,value:t.id}})}))],1),t._v(" "),t._l(t.form.plugins,function(e,r){return n("el-form-item",{key:r,staticClass:"plugin-item",attrs:{label:"plugin"}},["tempPlugin"!==r?n("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){t.showPlugin(r)}}},[t._v(t._s(r))]):t._e(),t._v(" "),"tempPlugin"!==r?n("el-button",{attrs:{type:"danger"},on:{click:function(e){e.preventDefault(),t.removePlugin(r)}}},[t._v("删除")]):t._e(),t._v(" "),"tempPlugin"===r?n("el-select",{staticClass:"plugin-select",attrs:{value:null,placeholder:"Select a Plugin"},on:{change:t.showPlugin}},t._l(t.filteredPluginList,function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})})):t._e()],1)}),t._v(" "),n("el-form-item",[n("el-button",{attrs:{disabled:!t.filteredPluginList.length},on:{click:t.addPlugin}},[t._v("添加 Plugin")])],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")]),t._v(" "),n("el-button",{on:{click:t.toPreviousPage}},[t._v("取消")])],1)],2),t._v(" "),n("PluginDialog",{attrs:{show:t.showPluginDialog,name:t.pluginName,"plugin-data":t.form.plugins[t.pluginName]},on:{hidePlugin:function(e){t.showPluginDialog=!1},save:t.onPluginSave}})],1)},[],!1,null,"95ea58ca",null);y.options.__file="edit.vue";e.default=y.exports},nGDx:function(t,e,n){var r=n("Y7ZC"),i=n("E8gZ")(!0);r(r.S,"Object",{entries:function(t){return i(t)}})},oF3Q:function(t,e,n){t.exports={default:n("tgZa"),__esModule:!0}},tgZa:function(t,e,n){n("nGDx"),t.exports=n("WEpk").Object.entries},xDdU:function(t,e,n){var r,i,a=n("4fRq"),u=n("I2ZF"),s=0,o=0;t.exports=function(t,e,n){var c=e&&n||0,l=e||[],f=(t=t||{}).node||r,p=void 0!==t.clockseq?t.clockseq:i;if(null==f||null==p){var d=a();null==f&&(f=r=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=i=16383&(d[6]<<8|d[7]))}var m=void 0!==t.msecs?t.msecs:(new Date).getTime(),v=void 0!==t.nsecs?t.nsecs:o+1,g=m-s+(v-o)/1e4;if(g<0&&void 0===t.clockseq&&(p=p+1&16383),(g<0||m>s)&&void 0===t.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=m,o=v,i=p;var h=(1e4*(268435455&(m+=122192928e5))+v)%4294967296;l[c++]=h>>>24&255,l[c++]=h>>>16&255,l[c++]=h>>>8&255,l[c++]=255&h;var b=m/4294967296*1e4&268435455;l[c++]=b>>>8&255,l[c++]=255&b,l[c++]=b>>>24&15|16,l[c++]=b>>>16&255,l[c++]=p>>>8|128,l[c++]=255&p;for(var w=0;w<6;++w)l[c+w]=f[w];return e||u(l)}}}]);
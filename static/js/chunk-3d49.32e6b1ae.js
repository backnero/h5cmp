(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3d49"],{Il65:function(e,t,n){"use strict";var i=n("y5eA");n.n(i).a},Y5bG:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),Math.easeInOutQuad=function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t};var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};function o(e,t,n){var o=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,r=e-o,s=0;t=void 0===t?500:t;!function e(){s+=20,function(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}(Math.easeInOutQuad(s,o,r,t)),s<t?i(e):n&&"function"==typeof n&&n()}()}},"gDS+":function(e,t,n){e.exports={default:n("oh+g"),__esModule:!0}},"j/Bd":function(e,t,n){"use strict";n.r(t);var i=n("gDS+"),o=n.n(i),r=n("QbLZ"),s=n.n(r),a=n("14Xm"),l=n.n(a),c=n("D3Ub"),u=n.n(c),d=n("t3Un"),p=function(e){return Object(d.a)({url:"organ/position/create",method:"post",data:e})},m=function(e){return Object(d.a)({url:"organ/position/remove/"+e,method:"DELETE"})},f=function(e){return Object(d.a)({url:"organ/bind/position/user/"+e,method:"get"})},v=function(e){return Object(d.a)({url:"organ/position/update",method:"put",data:e})},h=function(e,t){return Object(d.a)({url:"organ/position/users/"+e,method:"put",data:t})},g=function(e,t){return Object(d.a)({url:"organ/position/roles/"+e,method:"put",data:t})},b=n("Yfch"),_={components:{Pagination:n("Mz3J").a},props:{},data:function(){return{b_loading:!1,userState:!1,loading:!1,show:!1,state:!1,tableData:[],position:{},total:0,listQuery:{keyword:"",page:1,count:10,sort:"",type:""},userQuery:"",listLoading:!1,userLoading:!1,treeData:[],defaultProps:{children:"childs",value:"id",label:"title"},props:{children:"childs",value:"id",label:"title",checkStrictly:!0,multiple:!0,emitPath:!1},positionProps:{value:"id",label:"title"},form:{},userform:{},dialogFormVisible:!1,userDialogVisible:!1,multipleSelection:[],deleteSelection:[],options:[],ruleForm:{phone:[{required:!0,trigger:"blur",validator:function(e,t,n){Object(b.b)(t)?n():n(new Error("手机号不符合规则"))}}]},user:{},sourceID:[]}},watch:{},computed:{},methods:{getList:function(){var e=this;return u()(l.a.mark(function t(){var n,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(d.a)({url:"organ/position/tree",method:"get"});case 4:n=t.sent,(i=n.data).id="",e.treeData=new Array(i),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),e.treeData=[];case 13:e.loading=!1;case 14:case"end":return t.stop()}},t,e,[[1,10]])}))()},getRoles:function(){var e=this;return u()(l.a.mark(function t(){var n,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(d.a)({url:"organ/roles",method:"get"});case 2:n=t.sent,i=n.data,e.options=i;case 5:case"end":return t.stop()}},t,e)}))()},select_down:function(e,t,n,i){var o=this;if(2==e.button){this.show=!0;var r=this.$refs["dropdown-myMenu"];r.children[0].focus(),r.children[1].focus();var s=this.show?"block":"none";r.style.cssText="\n        z-index: 2028;\n        transform-origin: center top;\n        position: fixed;\n        top: "+e.clientY+"px;\n        left: "+e.clientX+"px;\n        display:"+s;var a=this;document.getElementById("append").onclick=function(){a.form.pid=t.id,a.state=!1,a.dialogFormVisible=!0,a.show=!1},document.getElementById("update").onclick=u()(l.a.mark(function e(){var n,i,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=11;break}return e.next=3,o.positioninfo(t.id);case 3:(n=e.sent).data.roles_info&&(o.sourceID=n.data.roles_info.map(function(e){return e.id})),i=n.data,r="root"===i.pid?"":i.pid,a.form={title:i.title,users_info:i.users_info,role_ids:i.roles_info?i.roles_info.map(function(e){return e.id}):[],pid:r,id:i.id,organ_id:i.organ_id},a.state=!0,a.dialogFormVisible=!0,a.show=!1;case 11:case"end":return e.stop()}},e,o)})),document.getElementById("delete_c").onclick=function(){null===t.childs&&t.id?a.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(u()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t.id);case 2:a.getList(),a.$message({type:"success",message:"删除成功!"});case 4:case"end":return e.stop()}},e,o)}))).catch(function(){a.$message({type:"info",message:"已取消删除"})}):o.$message({type:"warning",message:"警告哦，该"+t.title+"角色还有子角色因此不能删除!"}),a.show=!1}}},positioninfo:function(e){return function(e){return Object(d.a)({url:"organ/position/info/"+e,method:"get"})}(e)},emptyFromAction:function(){this.form={},this.state=!1},empty:function(){this.form={phone:""},this.user=[]},positionUsers:function(e){return function(e,t){return Object(d.a)({url:"organ/position/"+t+"/users",method:"get",params:e})}(this.listQuery,e)},createPosition:function(){var e=this;this.$refs.fromRole.validate(function(){var t=u()(l.a.mark(function t(n){var i,r,a,c,u;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.b_loading=!0,!n){t.next=26;break}if(!e.state){t.next=20;break}if(i=s()({},e.form),r=e.sourceID,a=i.role_ids,c={id:i.id,role_ids:[]},u={id:i.id,role_ids:[]},a.forEach(function(e){-1===r.indexOf(e)&&c.role_ids.push(e)}),r.forEach(function(e){-1===a.indexOf(e)&&u.role_ids.push(e)}),!(c.role_ids&&c.role_ids.length>0)){t.next=13;break}return t.next=13,g("add",o()(c));case 13:if(!(u.role_ids&&u.role_ids.length>0)){t.next=16;break}return t.next=16,g("remove",o()(u));case 16:return t.next=18,v(o()(i));case 18:t.next=22;break;case 20:return t.next=22,p(o()(e.form));case 22:e.getList(),e.b_loading=!1,e.dialogFormVisible=!1,e.$message({type:"success",message:"操作成功!"});case 26:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())},clickAction:function(e,t,n){"myPopper"!=n.tree.className&&0!=this.show&&(this.show=!1),this.position=e,this.getUserList()},getUserList:function(){var e=this;return u()(l.a.mark(function t(){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.next=3,e.positionUsers(e.position.id||"all");case 3:n=t.sent,e.tableData=n.data||[],e.total=n.meta.total||0,e.listLoading=!1;case 7:case"end":return t.stop()}},t,e)}))()},action_treeShow:function(e){"myPopper"!=e.target.className&&0!=this.show&&(this.show=!1)},openUserDialog:function(){this.position.id?this.userDialogVisible=!0:this.$message({type:"warning",message:"请先选择职位哟，亲!"})},addUsers:function(){var e=this;return u()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$refs.userform.validate(function(){var t=u()(l.a.mark(function t(n){var i,o;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return t.next=3,f(e.userform.phone);case 3:i=t.sent,(o=i.data)?e.user=o:(e.$message.warning("未查找到此用户!"),e.user=[]);case 6:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t,e)}))()},deleteSelectionChange:function(e){this.deleteSelection=e.map(function(e){return e.phone_num})},getRowkey:function(e){return e.phone_num},save:function(){var e=this;return u()(l.a.mark(function t(){var n,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.user){t.next=10;break}return n=s()({},e.user[0]),i={id:e.position.id,phones:n.phone_num?new Array(n.phone_num):[]},t.next=5,h("add",o()(i));case 5:e.getUserList(),e.$message({type:"success",message:"操作成功!"}),e.userDialogVisible=!1,t.next=11;break;case 10:e.$message({type:"warning",message:"请先选择职位哟，亲!"});case 11:case"end":return t.stop()}},t,e)}))()},remove:function(e){var t=this;return u()(l.a.mark(function n(){var i,r,s;return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.phone_num&&!t.deleteSelection.length){n.next=11;break}return i=t.position.id,r=[],r=e.phone_num?[e.phone_num]:t.deleteSelection,s=o()({id:i,phones:r}),n.next=7,h("remove",s);case 7:t.$message({type:"success",message:"删除成功!"}),t.getUserList(i),n.next=12;break;case 11:t.$message({type:"warning",message:"请选择删除数据!"});case 12:case"end":return n.stop()}},n,t)}))()}},created:function(){this.getList(),this.getRoles(),this.getUserList()},mounted:function(){document.addEventListener("click",this.action_treeShow)}},w=(n("Il65"),n("KHd+")),y=Object(w.a)(_,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"role-wrapper"},[n("div",{staticClass:"top"},[n("span",{on:{click:function(t){e.dialogFormVisible=!0}}},[n("i",{staticClass:"el-icon-circle-plus-outline"}),e._v("\n        添加职位\n      ")])]),e._v(" "),n("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"tree-wrapper",attrs:{id:"tree-wrapper",data:e.treeData,"node-key":"id","highlight-current":"",props:e.defaultProps,"default-expand-all":""},on:{"node-contextmenu":e.select_down,"node-click":e.clickAction}})],1)],1),e._v(" "),n("div",{staticClass:"table-wrapper"},[n("div",{staticClass:"head"},[n("div",{staticClass:"left-warpper"},[n("el-input",{attrs:{placeholder:"请输入关键字"},model:{value:e.listQuery.keyword,callback:function(t){e.$set(e.listQuery,"keyword",t)},expression:"listQuery.keyword"}}),e._v(" "),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.getUserList}},[e._v("搜索")]),e._v(" "),n("el-button",{on:{click:e.openUserDialog}},[e._v("新增用户")]),e._v(" "),n("el-button",{on:{click:e.remove}},[e._v("批量删除")])],1),e._v(" "),n("div",{staticClass:"right-warpper"},[n("span",{attrs:{id:"test"}},[e._v("职位名："+e._s(e.position.title||"default"))])])]),e._v(" "),n("div",{staticClass:"table"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#f5f7fa"},border:"",fit:"","highlight-current-row":"",data:e.tableData,"row-key":e.getRowkey},on:{"selection-change":e.deleteSelectionChange}},[n("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"uid",label:"uid",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"user_name",label:"用户名",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"phone_num",label:"手机号",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){e.remove(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),n("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.count},on:{"update:page":function(t){e.$set(e.listQuery,"page",t)},"update:limit":function(t){e.$set(e.listQuery,"count",t)},pagination:e.getUserList}})],1)]),e._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],ref:"dropdown-myMenu",staticClass:"myPopper",attrs:{id:"dropdown-myMenu"}},[n("li",{staticClass:"myMenu-c",attrs:{id:"append",tabindex:"-1"}},[e._v("添加子级")]),e._v(" "),n("li",{staticClass:"myMenu-c",attrs:{id:"update",tabindex:"-1"}},[e._v("修改")]),e._v(" "),n("li",{staticClass:"myMenu-c",attrs:{id:"delete_c",tabindex:"-1"}},[e._v("删除")])]),e._v(" "),n("el-dialog",{attrs:{title:"职位",visible:e.dialogFormVisible,width:"25%"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.emptyFromAction}},[n("el-form",{ref:"fromRole",attrs:{model:e.form,"label-width":"6em"}},[n("el-form-item",{attrs:{label:"pid"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.pid,callback:function(t){e.$set(e.form,"pid",t)},expression:"form.pid"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"关联角色"}},[n("el-cascader",{ref:"tree",attrs:{options:e.options,props:e.props,"show-all-levels":!1,clearable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data;return[n("span",[e._v(e._s(i.title))]),e._v(" "),"admin"===i.type?n("span",[n("i",{staticClass:"el-icon-star-on"})]):e._e()]}}]),model:{value:e.form.role_ids,callback:function(t){e.$set(e.form,"role_ids",t)},expression:"form.role_ids"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"职位名称",prop:"title",rules:[{required:!0,message:"职位名称不能为空"}]}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{loading:e.b_loading,type:"primary"},on:{click:e.createPosition}},[e._v("确 定")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"新增用户",visible:e.userDialogVisible,width:"35em"},on:{"update:visible":function(t){e.userDialogVisible=t},close:e.empty}},[n("el-form",{ref:"userform",staticClass:"bottom",attrs:{model:e.userform,rules:e.ruleForm,"status-icon":"","label-width":"5em"},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-form-item",{attrs:{prop:"phone",label:"关键字"}},[n("div",{staticClass:"item-wrapper bottom-o"},[n("div",{staticClass:"item-content"},[n("el-input",{attrs:{title:"三个字母的国家代码",placeholder:"请输入手机号"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.addUsers(t):null}},model:{value:e.userform.phone,callback:function(t){e.$set(e.userform,"phone",t)},expression:"userform.phone"}})],1),e._v(" "),n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return t.preventDefault(),e.addUsers(t)}}},[e._v("搜索")])],1)])],1),e._v(" "),n("div",{staticClass:"content"},e._l(e.user,function(t){return n("el-card",{directives:[{name:"show",rawName:"v-show",value:e.user,expression:"user"}],key:t.id,staticClass:"box-card"},[n("div",{staticClass:"item-wrapper"},[n("label",{staticClass:"item-text blod"},[e._v(e._s(t.user_name))])]),e._v(" "),n("div",{staticClass:"item-wrapper"},[n("label",{staticClass:"item-label"},[e._v("ID")]),e._v(" "),n("label",{staticClass:"item-text"},[e._v(e._s(t.uid))])]),e._v(" "),n("div",{staticClass:"item-wrapper"},[n("label",{staticClass:"item-label"},[e._v("手机号")]),e._v(" "),n("label",{staticClass:"item-text"},[e._v(e._s(t.phone_num))])])])})),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.userDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"5c63b631",null);y.options.__file="position.vue";t.default=y.exports},"oh+g":function(e,t,n){var i=n("WEpk"),o=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},y5eA:function(e,t,n){}}]);
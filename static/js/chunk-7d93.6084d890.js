(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7d93"],{"+rKV":function(e,t,n){"use strict";n.d(t,"c",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n("t3Un"),a=function(e){return Object(r.a)({url:"account/user/list",method:"get",params:e})},i=function(e){return Object(r.a)({url:"account/users/"+e,method:"get"})},o=function(e){Object(r.a)({url:"/account/bind",method:"delete",params:e})}},"25Oo":function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"a",function(){return s});var r=n("t3Un");n("vDqi");function a(){return Object(r.a)({url:"auth/role/tree",method:"get"})}function i(e){return Object(r.a)({url:"auth/role/del/"+e,method:"delete"})}function o(e){return Object(r.a)({url:"auth/role",method:"post",data:e})}function s(e){return Object(r.a)({url:"auth/role/detail/"+e,method:"get"})}},"92O9":function(e,t,n){},Crqj:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("t3Un"),a=function(){return Object(r.a)({url:"apisix/plugin/qisu/config",method:"get"})}},"gDS+":function(e,t,n){e.exports={default:n("oh+g"),__esModule:!0}},moOp:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"c",function(){return s});var r=n("t3Un");n("vDqi");function a(e){return Object(r.a)({url:"auth/policy/list",method:"get",params:e})}function i(e){return Object(r.a)({url:"auth/policy",method:"post",data:e})}function o(e){return Object(r.a)({url:"auth/policy/del/"+e,method:"delete"})}var s=function(e){return Object(r.a)({url:"auth/policy/detail/"+e,method:"get"})}},oYkb:function(e,t,n){"use strict";var r=n("92O9");n.n(r).a},"oh+g":function(e,t,n){var r=n("WEpk"),a=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},uIDs:function(e,t,n){"use strict";n.r(t);var r=n("gDS+"),a=n.n(r),i=n("m1cH"),o=n.n(i),s=n("GQeE"),l=n.n(s),c=n("14Xm"),u=n.n(c),d=n("D3Ub"),h=n.n(d),f=n("25Oo"),m=n("Crqj"),p=n("+rKV"),g=n("moOp"),b={components:{},props:{},data:function(){return{form:{title:"",subjects:[]},userQuery:{keyword:"",page:1,count:999,sort:""},total:"",rules:{},buttonSize:"large",selectArr:[],nowSelectData:[],nowSelectRightData:[],userData:[],listLoading:!1,treeLoading:!1,data:[],defaultProps:{children:"childs",label:"title"},obj_id:[],isEditMode:!1,res_amend:[],res_del:[],userLoading:!1,userIDSelection:[],defaultIDS:[]}},watch:{},computed:{},methods:{getTrees:function(){var e=this;return h()(u.a.mark(function t(){var n,r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.treeLoading=!0,t.next=3,Object(f.b)();case 3:n=t.sent,r=n.data,e.data=r,e.data.push({title:"*",id:"*",uid:"*"}),e.treeLoading=!1;case 8:case"end":return t.stop()}},t,e)}))()},getList:function(){var e=this;return h()(u.a.mark(function t(){var n,r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.next=3,Object(m.a)();case 3:n=t.sent,r=void 0,r=n.routes?n.routes.map(function(e){var t=e.key.match(/\/([a-zA-Z0-9-_]+)$/)[1],n=e.key,r=parseInt(t),a=e.value,i=a.uri,o=void 0===i?"":i,s=a.host,c=void 0===s?"":s,u=a.name,d=void 0===u?"":u,h=a.remote_addr,f=void 0===h?"":h,m=a.upstream_id,p=void 0===m?"":m,g=a.service_id,b=void 0===g?"":g,v=a.methods,_=void 0===v?[]:v,w=a.plugins,y=void 0===w?{}:w,k=a.desc,S=void 0===k?"":k;return e.value.uris&&(o=e.value.uris.join(", ")),e.value.hosts&&(c=e.value.hosts.join("\n ")),y=l()(y).join(", "),{id:r,realId:t,name:d,key:n,uri:o,host:c,remote_addr:f,upstream_id:p&&String(p).replace(/^(0+)/,""),service_id:b&&String(b).replace(/^(0+)/,""),methods:_,plugins:y,description:S}}):[],e.selectArr=r,e.isEditMode=-1===e.$route.name.indexOf("PermissionStrategyCreate"),e.isEditMode&&e.getPolicyData(r),e.total=r.length,e.listLoading=!1;case 11:case"end":return t.stop()}},t,e)}))()},getPolicyData:function(e){var t=this;return h()(u.a.mark(function n(){var r,a,i,s,l,c,d;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e,a=t.$route.params.id,n.next=4,Object(g.c)(a);case 4:i=n.sent,s=i.data,t.form.title=s.title,l=[],r.forEach(function(e){s.resources_assign&&s.resources_assign.forEach(function(t){e.key===t.resource&&l.push(e)})}),t.form.subjects=[].concat(o()(t.form.subjects),l),t.handleRemoveTabList(l,t.selectArr),c=s.subjects_user.map(function(e){return e.id}),d=s.subjects_role.map(function(e){return e.id}),t.defaultIDS=[].concat(o()(d),o()(c)),t.userData.forEach(function(e){-1!==c.indexOf(e.id)&&t.$refs.multipleTable.toggleRowSelection(e,!0)}),t.$refs.tree.setCheckedNodes(s.subjects_role),t.obj_id=d,t.userIDSelection=c;case 18:case"end":return n.stop()}},n,t)}))()},usersList:function(){var e=this;return h()(u.a.mark(function t(){var n;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.userLoading=!0,t.next=3,Object(p.c)(e.userQuery);case 3:n=t.sent,e.userData=n.data,e.userLoading=!1;case 6:case"end":return t.stop()}},t,e)}))()},tree_chenge:function(e,t){this.obj_id=t.checkedNodes.map(function(e){return e.id})},checkAll:function(e){this.nowSelectData=e},checkRightAll:function(e){this.nowSelectRightData=e},handelSelect:function(){var e=this.nowSelectData,t=this.res_amend.map(function(e){return e.id});console.log(t),console.log(e);var n=e.filter(function(e){return-1===t.indexOf(e.id)});this.res_del=[].concat(o()(this.res_del),o()(n)),this.selectRemove(this.res_amend,e),this.selectArr=[].concat(o()(this.selectArr),o()(e)),this.handleRemoveTabList(this.nowSelectData,this.form.subjects),this.nowSelectData=[]},handleRemoveSelect:function(){var e=this.nowSelectRightData;this.selectRemove(this.res_del,e),this.res_amend=[].concat(o()(this.res_amend),o()(e)),this.form.subjects=[].concat(o()(this.form.subjects),o()(e)),this.handleRemoveTabList(this.nowSelectRightData,this.selectArr),this.nowSelectRightData=[]},selectRemove:function(e,t){if(e.length&&t.length)for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++)e[n].id===t[r].id&&e.splice(n,1)},handleRemoveTabList:function(e,t){if(e.length&&t.length)for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++)e[n].id===t[r].id&&t.splice(r,1)},onSubmit:function(){var e=this;this.$refs.form.validate(function(){var t=h()(u.a.mark(function t(n){var r,i,s,l,c,d,h,f;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=11;break}return r=e.res_amend.map(function(e){return{action:e.methods,resource:e.key}}),i=e.res_del.map(function(e){return{action:e.methods,resource:e.key}}),s={title:e.form.title,res_amend:r,res_del:i},l=[].concat(o()(e.obj_id),o()(e.userIDSelection)),e.isEditMode?(c=e.defaultIDS,d=[],h=[],s.id=e.$route.params.id,l.forEach(function(e){-1===c.indexOf(e)&&d.push(e)}),c.forEach(function(e){-1===l.indexOf(e)&&h.push(e)}),s.sub_amend=d,s.sub_del=h):s.sub_amend=l,f=a()(s),t.next=9,Object(g.a)(f);case 9:e.$message({type:"success",message:(e.isEditMode?"保存":"添加")+"成功!"}),e.$router.push({name:"PermissionStrategyList"});case 11:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())},getRowkey:function(e){return e.id},selectionChange:function(e){this.userIDSelection=e.map(function(e){return e.id})}},created:function(){this.getList(),this.usersList(),this.getTrees()},mounted:function(){}},v=(n("oYkb"),n("KHd+")),_=Object(v.a)(b,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules,"label-width":"6em","show-message":!1}},[n("el-form-item",{attrs:{label:"策略名称:"}},[n("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"添加对象:"}},[n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"tree",staticClass:"tree-wrapper",attrs:{data:e.data,"node-key":"id","highlight-current":"","default-expand-all":"","show-checkbox":"","check-strictly":"",props:e.defaultProps},on:{check:e.tree_chenge}})],1),e._v(" "),n("el-form-item",[n("el-input",{staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:"输入关键字搜索",clearable:""},model:{value:e.userQuery.keyword,callback:function(t){e.$set(e.userQuery,"keyword",t)},expression:"userQuery.keyword"}}),e._v(" "),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.usersList}},[e._v("\n        搜索\n      ")]),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#f5f7fa"},border:"",fit:"","highlight-current-row":"",data:e.userData,"max-height":"300","row-key":e.getRowkey},on:{"selection-change":e.selectionChange}},[n("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"id",label:"uuid",width:"300",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"user_name",label:"用户名",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"uid",label:"用户编号",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"phone_num",label:"手机号",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"创建时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("formatDate")(t.row.create_time,"yyyy-MM-dd hh:mm:ss"))+"\n          ")]}}])})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"添加资源:"}},[n("el-row",{staticClass:"table-wrapper",attrs:{gutter:20}},[n("el-col",{attrs:{span:11,height:"100%"}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"selection",staticStyle:{width:"100%"},attrs:{data:e.selectArr,"header-cell-style":{background:"#f5f7fa"},border:"",fit:"","highlight-current-row":"","max-height":"380"},on:{"selection-change":e.checkRightAll}},[n("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",width:"150",label:"name",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"host",width:"150",label:"域名",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"uri",width:"200",label:"URL",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"方法",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.methods,function(r,a){return n("span",{key:a},[n("span",[e._v(e._s(r))]),e._v(" "),t.row.methods.length-1>a?n("el-divider",{attrs:{direction:"vertical"}}):e._e()],1)})}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"description",width:"200",label:"描述",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"key",width:"200",label:"key",align:"center"}})],1)],1),e._v(" "),n("el-col",{staticClass:"center",attrs:{span:2}},[n("div",{staticClass:"opSetting"},[n("div",{on:{click:e.handleRemoveSelect}},[n("el-button",{attrs:{icon:"el-icon-arrow-right",disabled:!e.nowSelectRightData.length,size:e.buttonSize,type:"primary"}})],1),e._v(" "),n("div",{staticClass:"spacing",on:{click:e.handelSelect}},[n("el-button",{attrs:{icon:"el-icon-arrow-left",disabled:!e.nowSelectData.length,size:e.buttonSize,type:"primary"}})],1)])]),e._v(" "),n("el-col",{attrs:{span:11}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"selection",staticStyle:{width:"100%"},attrs:{data:e.form.subjects,"header-cell-style":{background:"#f5f7fa"},border:"",fit:"","highlight-current-row":"","max-height":"380"},on:{"selection-change":e.checkAll}},[n("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",width:"150",label:"name",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"host",width:"150",label:"域名",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"uri",width:"200",label:"URL",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"方法",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.methods,function(r,a){return n("span",{key:a},[n("span",[e._v(e._s(r))]),e._v(" "),t.row.methods.length-1>a?n("el-divider",{attrs:{direction:"vertical"}}):e._e()],1)})}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"description",width:"200",label:"描述",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"key",width:"200",label:"key",align:"center"}})],1)],1)],1)],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")]),e._v(" "),n("el-button",{on:{click:function(t){e.$router.push({name:"PermissionStrategyList"})}}},[e._v("取消")])],1)],1)],1)},[],!1,null,"86e04664",null);_.options.__file="edit.vue";t.default=_.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-b8c5"],{"+rKV":function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var a=n("t3Un"),r=function(e){return Object(a.a)({url:"account/user/list",method:"get",params:e})},i=function(e){return Object(a.a)({url:"account/users/"+e,method:"get"})},o=function(e){Object(a.a)({url:"/account/bind",method:"delete",params:e})}},"144x":function(e,t,n){"use strict";n.r(t);var a=n("gDS+"),r=n.n(a),i=n("14Xm"),o=n.n(i),s=n("D3Ub"),l=n.n(s),c=n("Mz3J"),u=n("25Oo"),d=n("+rKV"),p={components:{Pagination:c.a},props:{},data:function(){return{loading:!1,show:!1,tableData:[],tableDataKey:[],userdata:[],userQuery:{keyword:"",page:1,count:10,sort:"",type:[]},usertotal:0,role:{},listQuery:{page:1,limit:20,keyword:""},listLoading:!1,userLoading:!1,treeData:[],defaultProps:{children:"childs",label:"title"},form:{},dialogFormVisible:!1,userDialogVisible:!1,multipleSelection:[],deleteSelection:[]}},watch:{},computed:{},methods:{getList:function(){var e=this;return l()(o.a.mark(function t(){var n,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(u.b)();case 3:n=t.sent,a=n.data,e.treeData=a,e.loading=!1;case 7:case"end":return t.stop()}},t,e)}))()},select_down:function(e,t,n,a){var r=this;if(2==e.button){this.show=!0;var i=this.$refs["dropdown-myMenu"];i.children[0].focus(),i.children[1].focus();var s=this.show?"block":"none";i.style.cssText="\n        z-index: 2028;\n        transform-origin: center top;\n        position: fixed;\n        top: "+e.clientY+"px;\n        left: "+e.clientX+"px;\n        display:"+s;var c=this;document.getElementById("append").onclick=function(){c.form.pid=t.id,c.dialogFormVisible=!0,c.show=!1},document.getElementById("update").onclick=l()(o.a.mark(function e(){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.roleInfo(t.id);case 2:n=e.sent,c.form=n.data,c.dialogFormVisible=!0,c.show=!1;case 6:case"end":return e.stop()}},e,r)})),document.getElementById("delete_c").onclick=function(){null===t.childs?c.$confirm("此操作将永久删除"+t.title+"角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(l()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.c)(t.id);case 2:c.getList(),c.$message({type:"success",message:"删除成功!"});case 4:case"end":return e.stop()}},e,r)}))).catch(function(){c.$message({type:"info",message:"已取消删除"})}):r.$message({type:"warning",message:"警告哦，该"+t.title+"角色还有子角色因此不能删除!"}),c.show=!1}}},emptyFromAction:function(){this.form={}},createRole:function(){var e=this;this.$refs.fromRole.validate(function(){var t=l()(o.a.mark(function t(n){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return t.next=3,Object(u.d)(r()(e.form));case 3:e.getList(),e.dialogFormVisible=!1,e.$message({type:"success",message:"添加成功!"});case 6:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())},clickAction:function(e,t,n){"myPopper"!=n.tree.className&&0!=this.show&&(this.show=!1),this.role=e,this.getUserList(e.id)},roleInfo:function(e){return Object(u.a)(e)},getUserList:function(e){var t=this;return l()(o.a.mark(function n(){var a,r,i;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.listLoading=!0,n.next=3,t.roleInfo(e);case 3:if(a=n.sent,""===(r=a.data.uids)){n.next=13;break}return n.next=8,Object(d.a)(r);case 8:i=n.sent,t.tableData=i.data,t.tableDataKey=i.data.map(function(e){return e.id}),n.next=15;break;case 13:t.tableData=[],t.tableDataKey=[];case 15:t.listLoading=!1;case 16:case"end":return n.stop()}},n,t)}))()},action_treeShow:function(e){"myPopper"!=e.target.className&&0!=this.show&&(this.show=!1)},openUserDialog:function(){this.role.id?(this.getUsersList(),this.userDialogVisible=!0):this.$message({type:"warning",message:"请先选择角色哟，亲!"})},getUsersList:function(){var e=this;return l()(o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.userLoading=!0,t.next=3,Object(d.c)(e.userQuery);case 3:n=t.sent,e.userdata=n.data,e.usertotal=n.meta.total,e.userLoading=!1;case 7:case"end":return t.stop()}},t,e)}))()},handleSelectionChange:function(e){this.multipleSelection=e.map(function(e){return e.id})},deleteSelectionChange:function(e){this.deleteSelection=e.map(function(e){return e.id})},getRowkey:function(e){return e.id},save:function(){var e=this;return l()(o.a.mark(function t(){var n,a,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.role.id,a=e.role.pid,i=r()({id:n,pid:a,uids_amend:e.multipleSelection}),t.next=5,Object(u.d)(i);case 5:e.$message({type:"success",message:"保存成功!"}),e.getUserList(n),e.userDialogVisible=!1;case 8:case"end":return t.stop()}},t,e)}))()},remove:function(e){var t=this;return l()(o.a.mark(function n(){var a,i,s,l;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.id&&!t.deleteSelection.length){n.next=12;break}return a=t.role.id,i="root"===t.role.pid?"":t.role.pid,s=[],s=e.id?[e.id]:t.deleteSelection,l=r()({id:a,pid:i,uids_del:s}),n.next=8,Object(u.d)(l);case 8:t.$message({type:"success",message:"删除成功!"}),t.getUserList(a),n.next=13;break;case 12:t.$message({type:"warning",message:"请选择删除数据!"});case 13:case"end":return n.stop()}},n,t)}))()}},created:function(){this.getList()},mounted:function(){document.addEventListener("click",this.action_treeShow)}},f=(n("A+6w"),n("KHd+")),m=Object(f.a)(p,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"role-wrapper"},[n("div",{staticClass:"top"},[n("span",{on:{click:function(t){e.dialogFormVisible=!0}}},[n("i",{staticClass:"el-icon-circle-plus-outline"}),e._v("\n        添加角色\n      ")])]),e._v(" "),n("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"tree-wrapper",attrs:{id:"tree-wrapper",data:e.treeData,"node-key":"id","highlight-current":"",props:e.defaultProps,"default-expand-all":""},on:{"node-contextmenu":e.select_down,"node-click":e.clickAction}})],1)],1),e._v(" "),n("div",{staticClass:"table-wrapper"},[n("div",{staticClass:"head"},[n("div",{staticClass:"left-warpper"},[n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.listQuery.keyword,callback:function(t){e.$set(e.listQuery,"keyword",t)},expression:"listQuery.keyword"}}),e._v(" "),n("el-button",{attrs:{type:"primary"}},[e._v("搜索")]),e._v(" "),n("el-button",{on:{click:e.openUserDialog}},[e._v("新增用户")]),e._v(" "),n("el-button",{on:{click:e.remove}},[e._v("批量删除")])],1),e._v(" "),n("div",{staticClass:"right-warpper"},[n("span",{attrs:{id:"test"}},[e._v("角色名："+e._s(e.role.title||"default"))]),e._v(" "),n("span",[e._v("角色标识："+e._s(e.role.id||"default"))])])]),e._v(" "),n("div",{staticClass:"table"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#f5f7fa"},border:"",fit:"","highlight-current-row":"",data:e.tableData,"row-key":e.getRowkey},on:{"selection-change":e.deleteSelectionChange}},[n("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"id",label:"用户id",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"title",label:"用户名",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"phone_num",label:"手机号",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){e.remove(t.row)}}},[e._v("删除")])]}}])})],1)],1)]),e._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],ref:"dropdown-myMenu",staticClass:"myPopper",attrs:{id:"dropdown-myMenu"}},[n("li",{staticClass:"myMenu-c",attrs:{id:"append",tabindex:"-1"}},[e._v("添加子级")]),e._v(" "),n("li",{staticClass:"myMenu-c",attrs:{id:"update",tabindex:"-1"}},[e._v("修改")]),e._v(" "),n("li",{staticClass:"myMenu-c",attrs:{id:"delete_c",tabindex:"-1"}},[e._v("删除")])]),e._v(" "),n("el-dialog",{attrs:{title:"添加角色",visible:e.dialogFormVisible,width:"25%"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.emptyFromAction}},[n("el-form",{ref:"fromRole",attrs:{model:e.form,"label-width":"6em"}},[n("el-form-item",{attrs:{label:"pid"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.pid,callback:function(t){e.$set(e.form,"pid",t)},expression:"form.pid"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色名称",prop:"title",rules:[{required:!0,message:"角色名称不能为空"}]}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.createRole}},[e._v("确 定")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"新增用户",visible:e.userDialogVisible,width:"80%"},on:{"update:visible":function(t){e.userDialogVisible=t}}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#f5f7fa"},border:"",fit:"","highlight-current-row":"",data:e.userdata.filter(function(t){return-1===e.tableDataKey.indexOf(t.id)}),"row-key":e.getRowkey},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"id",label:"uuid",width:"300",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"user_name",label:"用户名",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"uid",label:"用户编号",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"phone_num",label:"手机号",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"创建时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(t.row.create_time,"yyyy-MM-dd hh:mm:ss")))]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"过期时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(t.row.update_time,"yyyy-MM-dd hh:mm:ss")))]}}])})],1),e._v(" "),n("pagination",{directives:[{name:"show",rawName:"v-show",value:e.usertotal>0,expression:"usertotal > 0"}],attrs:{total:e.usertotal,page:e.userQuery.page,limit:e.userQuery.count},on:{"update:page":function(t){e.$set(e.userQuery,"page",t)},"update:limit":function(t){e.$set(e.userQuery,"count",t)},pagination:e.getUsersList}}),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.userDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"1ce574b2",null);m.options.__file="role.vue";t.default=m.exports},"25Oo":function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"a",function(){return s});var a=n("t3Un");n("vDqi");function r(){return Object(a.a)({url:"auth/role/tree",method:"get"})}function i(e){return Object(a.a)({url:"auth/role/del/"+e,method:"delete"})}function o(e){return Object(a.a)({url:"auth/role",method:"post",data:e})}function s(e){return Object(a.a)({url:"auth/role/detail/"+e,method:"get"})}},"33HV":function(e,t,n){},"A+6w":function(e,t,n){"use strict";var a=n("33HV");n.n(a).a},Y5bG:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),Math.easeInOutQuad=function(e,t,n,a){return(e/=a/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t};var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};function r(e,t,n){var r=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,i=e-r,o=0;t=void 0===t?500:t;!function e(){o+=20,function(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}(Math.easeInOutQuad(o,r,i,t)),o<t?a(e):n&&"function"==typeof n&&n()}()}},"gDS+":function(e,t,n){e.exports={default:n("oh+g"),__esModule:!0}},"oh+g":function(e,t,n){var a=n("WEpk"),r=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}}}]);